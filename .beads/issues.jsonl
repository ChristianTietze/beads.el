{"id":"bdel-04e","title":"Implement close issue command","description":"Add functionality to close issues from within beads.el. Currently shows \"Close issue not yet implemented\" message in beads-transient.el.","status":"closed","priority":2,"issue_type":"feature","created_at":"2025-12-17T14:11:19.180412+01:00","updated_at":"2025-12-17T14:39:19.659398+01:00","closed_at":"2025-12-17T14:39:19.659398+01:00","close_reason":"Implemented: works from list and detail view, prompts for optional reason"}
{"id":"bdel-0e9","title":"Auto-refresh beads list in background","description":"Auto-refresh the beads list buffer periodically in the background, preserving the current selection.\n\nRequirements:\n1. Remember which issue is selected (by ID) before refresh\n2. Create `beads-list-goto-id` function to move point to line with specific ID\n3. After refresh, restore selection to the same issue ID\n4. New `beads-autoupdate.el` module for timer management\n5. Buffer-local `beads-autoupdate-message` variable (t by default)\n6. Support dir-local settings to reduce noise in busy projects\n\nUser experience:\n- List updates automatically while browsing\n- Selection stays on the same issue even if list order changes\n- Optional: show \"Refreshed N issues\" message (can disable)\n- Graceful handling when selected issue no longer exists\n\nAcceptance criteria:\n- beads-list-goto-id finds issue by ID\n- Selection preserved after manual refresh (g)\n- Selection preserved after auto-refresh\n- Timer starts/stops with buffer lifecycle\n- Message can be disabled buffer-locally\n- Dir-locals work for message setting\n- Graceful when selected issue deleted","design":"Implementation plan:\n\n## 1. Add `beads-list-goto-id` function (beads-list.el)\n```elisp\n(defun beads-list-goto-id (id)\n  \"Move point to the line with issue ID, return t if found.\"\n  (goto-char (point-min))\n  (while (and (not (eobp))\n              (not (equal id (tabulated-list-get-id))))\n    (forward-line 1))\n  (not (eobp)))\n```\n\n## 2. Update `beads-list-refresh` to preserve selection\n- Before refresh: save `(tabulated-list-get-id)`\n- After refresh: call `beads-list-goto-id` with saved ID\n- If ID not found, stay at same line number or top\n\n## 3. Create `beads-autoupdate.el`\n```elisp\n(defcustom beads-autoupdate-interval 30\n  \"Seconds between auto-refresh. nil to disable.\"\n  :type '(choice (const :tag \"Disabled\" nil)\n                 (integer :tag \"Seconds\"))\n  :group 'beads)\n\n(defvar-local beads-autoupdate-message t\n  \"Whether to show message on auto-refresh.\nCan be set in .dir-locals.el to reduce noise.\")\n\n(defvar-local beads-autoupdate--timer nil\n  \"Timer for auto-refresh in this buffer.\")\n\n(defun beads-autoupdate-start ()\n  \"Start auto-refresh timer for current buffer.\")\n\n(defun beads-autoupdate-stop ()\n  \"Stop auto-refresh timer for current buffer.\")\n\n(define-minor-mode beads-autoupdate-mode\n  \"Minor mode for auto-refreshing beads list buffers.\")\n```\n\n## 4. Hook into beads-list-mode\n- Optionally enable autoupdate-mode by default\n- Or provide `beads-list-autoupdate` customization\n\n## 5. Dir-local support\n```elisp\n;; In .dir-locals.el:\n((beads-list-mode . ((beads-autoupdate-message . nil))))\n```","status":"closed","priority":2,"issue_type":"feature","created_at":"2025-12-17T13:52:02.286575+01:00","updated_at":"2025-12-17T13:58:18.108909+01:00","closed_at":"2025-12-17T13:58:18.108909+01:00","close_reason":"Implemented: beads-list-goto-id, selection preservation in refresh, beads-autoupdate.el with timer management and dir-local support"}
{"id":"bdel-0kf","title":"Create beads-undo.el core module","description":"Create the core undo/redo module with:\n\n- `beads-undo-entry` cl-defstruct (issue-id, field, old-value, new-value, timestamp, description)\n- `beads-undo--stack` and `beads-undo--redo-stack` variables\n- `beads-undo-limit` customization (default 50)\n- `beads-undo-record` function to push entries\n- `beads-undo` command to undo last edit\n- `beads-redo` command to redo\n- `beads-undo-clear` command to clear history\n- Stack size enforcement (trim when over limit)\n\nDoes NOT include integration with edit commands yet.","status":"open","priority":2,"issue_type":"task","created_at":"2025-12-17T15:01:30.675454+01:00","updated_at":"2025-12-17T15:01:30.675454+01:00","dependencies":[{"issue_id":"bdel-0kf","depends_on_id":"bdel-dyk","type":"parent-child","created_at":"2025-12-17T15:01:45.682167+01:00","created_by":"daemon"}]}
{"id":"bdel-1ui","title":"Implement edit design notes feature","description":"Add 'e D' keybinding to edit design notes:\n- Same pattern as description editing\n- Opens markdown-mode buffer\n- C-c C-c commits via :design field\n- Buffer name: *beads-edit: ISSUE-ID design*","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-17T12:59:14.823839+01:00","updated_at":"2025-12-17T13:34:25.157363+01:00","closed_at":"2025-12-17T13:08:02.086461+01:00","close_reason":"Completed","dependencies":[{"issue_id":"bdel-1ui","depends_on_id":"bdel-ab3","type":"parent-child","created_at":"2025-12-17T12:59:36.984012+01:00","created_by":"daemon"}]}
{"id":"bdel-3ph","title":"Implement edit external-ref via minibuffer","description":"Add 'e x' keybinding to edit external reference:\n- Use read-string with current external-ref as default\n- Example values: gh-123, jira-ABC-456\n- Commit via beads-rpc-update with :external-ref","status":"closed","priority":3,"issue_type":"task","created_at":"2025-12-17T12:59:16.113614+01:00","updated_at":"2025-12-17T13:08:08.467113+01:00","closed_at":"2025-12-17T13:08:08.467113+01:00","close_reason":"Completed","dependencies":[{"issue_id":"bdel-3ph","depends_on_id":"bdel-ab3","type":"parent-child","created_at":"2025-12-17T12:59:45.339455+01:00","created_by":"daemon"}]}
{"id":"bdel-3v1","title":"Integrate undo with label operations","description":"Add undo recording to label add/remove in beads-detail.el:\n\n- beads-detail-edit-label-add: record old labels array, new labels array\n- beads-detail-edit-label-remove: record old labels array, new labels array\n\nFor undo, need to use beads-rpc-update with :set-labels to restore entire label array (simpler than tracking individual add/remove).","status":"open","priority":2,"issue_type":"task","created_at":"2025-12-17T15:01:31.19597+01:00","updated_at":"2025-12-17T15:01:31.19597+01:00","dependencies":[{"issue_id":"bdel-3v1","depends_on_id":"bdel-dyk","type":"parent-child","created_at":"2025-12-17T15:01:46.113136+01:00","created_by":"daemon"},{"issue_id":"bdel-3v1","depends_on_id":"bdel-0kf","type":"blocks","created_at":"2025-12-17T15:01:58.973768+01:00","created_by":"daemon"}]}
{"id":"bdel-4dg","title":"Implement edit assignee via minibuffer","description":"Add 'e A' keybinding to edit assignee:\n- Use read-string with current assignee as default\n- Empty string clears assignee\n- Commit via beads-rpc-update with :assignee","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-17T12:59:15.673096+01:00","updated_at":"2025-12-17T13:08:08.297678+01:00","closed_at":"2025-12-17T13:08:08.297678+01:00","close_reason":"Completed","dependencies":[{"issue_id":"bdel-4dg","depends_on_id":"bdel-ab3","type":"parent-child","created_at":"2025-12-17T12:59:45.109044+01:00","created_by":"daemon"}]}
{"id":"bdel-4e6","title":"Integrate undo with beads-edit.el (markdown edits)","description":"Add undo recording to beads-edit--exit() for markdown field edits:\n\n- description, design, acceptance_criteria, notes\n- Call beads-undo-record before beads-rpc-update\n- Pass: issue-id, field keyword, original content, new content\n- Generate description like \"description on bdel-xyz\"\n\nEdit beads-edit.el lines ~71 to add the hook.","status":"open","priority":2,"issue_type":"task","created_at":"2025-12-17T15:01:30.841452+01:00","updated_at":"2025-12-17T15:01:30.841452+01:00","dependencies":[{"issue_id":"bdel-4e6","depends_on_id":"bdel-dyk","type":"parent-child","created_at":"2025-12-17T15:01:45.822357+01:00","created_by":"daemon"},{"issue_id":"bdel-4e6","depends_on_id":"bdel-0kf","type":"blocks","created_at":"2025-12-17T15:01:58.67914+01:00","created_by":"daemon"}]}
{"id":"bdel-5w1","title":"Milestone 1: Read issues from beads and display in interactive list","description":"Our first goal is to teach Emacs to run the Beats.el mode, Introduce that mode in the first place and in that mode list all issues from the Beats database. The database listing then shows in the table view the issue ID, the statios like priority, the kind of task it is, whether it's open or closed, and then also the title of course, but not the description. The description is reserved for the detail view display. So we have an overview and a detail view, and you get to the detail view by interacting with the overview, you're pressing return to essentially open the task in the viewer. Check out @docs/emacs-ui.md for how the UI works and @docs/beads-client-howto.md for the overall plan and approach","status":"closed","priority":2,"issue_type":"epic","created_at":"2025-12-17T07:55:27.505205+01:00","updated_at":"2025-12-17T11:33:57.46743+01:00","closed_at":"2025-12-17T11:33:57.46743+01:00","close_reason":"All subtasks completed: RPC, list mode, detail view, entry point, transient menus, preview mode, state management, and filter system"}
{"id":"bdel-5z1","title":"Integrate undo with beads-detail.el (inline edits)","description":"Add undo recording to detail view inline edits:\n\n- beads-detail-edit-title (minibuffer)\n- beads-detail-edit-status (completing-read)\n- beads-detail-edit-priority (completing-read)\n- beads-detail-edit-type (completing-read)\n- beads-detail-edit-assignee (minibuffer)\n- beads-detail-edit-external-ref (minibuffer)\n\nEach function already has old value available. Add beads-undo-record call before RPC update.","status":"open","priority":2,"issue_type":"task","created_at":"2025-12-17T15:01:31.016841+01:00","updated_at":"2025-12-17T15:01:31.016841+01:00","dependencies":[{"issue_id":"bdel-5z1","depends_on_id":"bdel-dyk","type":"parent-child","created_at":"2025-12-17T15:01:45.965508+01:00","created_by":"daemon"},{"issue_id":"bdel-5z1","depends_on_id":"bdel-0kf","type":"blocks","created_at":"2025-12-17T15:01:58.822521+01:00","created_by":"daemon"}]}
{"id":"bdel-6qd","title":"Implement edit type with completing-read.","description":"Add 'e T' keybinding to change issue type:\n- Use completing-read with options: bug, feature, task, epic, chore\n- Current type as default\n- Commit via beads-rpc-update with :issue-type","status":"closed","priority":1,"issue_type":"task","created_at":"2025-12-17T12:59:15.533546+01:00","updated_at":"2025-12-17T18:25:19.348469+01:00","closed_at":"2025-12-17T13:08:03.221699+01:00","close_reason":"Completed","dependencies":[{"issue_id":"bdel-6qd","depends_on_id":"bdel-ab3","type":"parent-child","created_at":"2025-12-17T12:59:37.500941+01:00","created_by":"daemon"}]}
{"id":"bdel-7mu","title":"Integrate undo with beads-form.el (batch edits)","description":"Add undo recording to beads-form-commit for multi-field edits:\n\n- Create compound undo entry with field type :batch\n- old-value: alist of all original field values\n- new-value: alist of all new field values\n- On undo, call beads-rpc-update with all old values at once\n\nThis ensures form edits undo as a single operation, not field-by-field.","status":"open","priority":2,"issue_type":"task","created_at":"2025-12-17T15:01:31.378955+01:00","updated_at":"2025-12-17T15:01:31.378955+01:00","dependencies":[{"issue_id":"bdel-7mu","depends_on_id":"bdel-dyk","type":"parent-child","created_at":"2025-12-17T15:01:46.256071+01:00","created_by":"daemon"},{"issue_id":"bdel-7mu","depends_on_id":"bdel-0kf","type":"blocks","created_at":"2025-12-17T15:01:59.112886+01:00","created_by":"daemon"}]}
{"id":"bdel-92j","title":"Form editor: colons in text content break field boundaries","description":"When a description or other multi-line text field contains colons, the field boundary detection is wrong. The greedy regex matches the last colon, making part of the content appear as a label (non-editable) while only the text after the last colon is editable.\n\nExample: \"Description: some text with: embedded colons\" - only \"embedded colons\" becomes editable.","design":"**Root cause**: Likely in `beads-form--add-text-field` or the face/property application.\n\n**Fix approach**: The label (\"Description:\") should be rendered separately from the widget value. Don't use regex to split - render label with `widget-insert`, then create widget for value only.","status":"open","priority":2,"issue_type":"bug","created_at":"2025-12-17T18:33:21.523974+01:00","updated_at":"2025-12-17T18:33:21.523974+01:00"}
{"id":"bdel-9ik","title":"Form editor: derive from nil, not special-mode","description":"Fixed bug where text fields in the form editor (E) couldn't receive keyboard input.","design":"**Design Decision**: `beads-form-mode` derives from `nil` (fundamental-mode), not `special-mode`.\n\n**Rationale**:\n- `special-mode` sets `buffer-read-only t`, which blocks editable-field and text widgets\n- Menu-choice widgets worked because they use overlays/keymaps, bypassing buffer modification\n- Emacs's built-in `Custom-mode` (cus-edit.el) uses the same pattern: `(define-derived-mode Custom-mode nil \"Custom\" ...)`\n- `special-mode` is designed for read-only display buffers (help, completion lists)\n- Widget-based editable forms should derive from `nil`","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-17T18:31:20.351046+01:00","updated_at":"2025-12-17T18:31:24.350772+01:00","closed_at":"2025-12-17T18:31:24.350772+01:00","close_reason":"Fixed in commits c9da5d7 and 68313f8"}
{"id":"bdel-a1v","title":"Implement edit notes feature","description":"Add 'e n' keybinding to edit notes:\n- Same markdown-mode buffer pattern as description\n- C-c C-c commits via :notes field\n- Buffer name: *beads-edit: ISSUE-ID notes*","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-17T12:59:15.959924+01:00","updated_at":"2025-12-17T13:08:02.492684+01:00","closed_at":"2025-12-17T13:08:02.492684+01:00","close_reason":"Completed","dependencies":[{"issue_id":"bdel-a1v","depends_on_id":"bdel-ab3","type":"parent-child","created_at":"2025-12-17T12:59:45.257015+01:00","created_by":"daemon"}]}
{"id":"bdel-ab3","title":"Milestone 2: Editing tasks from list and detail view","description":"Enable editing of beads issues from within Emacs, with a rich editing experience for long-form text fields (description, design, acceptance criteria) and convenient completion-based editing for metadata fields.\n\nKey patterns to implement:\n- Dedicated edit buffers for long text (like org-src-mode) with C-c C-c to commit, C-c C-k to discard\n- completing-read for constrained fields (status, priority, type)\n- Minibuffer for simple text fields (title, assignee, external-ref)\n- Stretch: form-based UI like custom.el for metadata editing\n\nAll fields from `bd update` should be editable:\n- title, description, status, priority, type, assignee\n- design, acceptance (criteria), notes, external-ref, estimate\n- labels (add/remove/set)","design":"Research findings (org-src-mode pattern):\n1. Create dedicated buffer with buffer-local markers for source positions\n2. Store original content for abort comparison\n3. Use single code path with gate flag (org-src--allow-write-back pattern)\n4. Minor mode provides C-c C-c (commit) and C-c C-k (abort) bindings\n5. On commit: call beads-rpc-update with changed field\n6. On abort: just kill buffer, no RPC call\n\nFor long text fields: use markdown-mode in edit buffer\nFor metadata: completing-read or form UI","status":"closed","priority":1,"issue_type":"epic","created_at":"2025-12-17T12:58:43.587904+01:00","updated_at":"2025-12-17T13:17:00.981304+01:00","closed_at":"2025-12-17T13:17:00.981304+01:00","close_reason":"All core editing features implemented: markdown buffers for long text, completing-read for constrained fields, minibuffer for text fields, and label management. Stretch goal (form-based editor) remains optional."}
{"id":"bdel-aw7","title":"Implement filter system","description":"Create beads-filter.el with composable higher-order filters. Filter by status, priority, type, assignee. Pipeline composition pattern. See docs/emacs-ui.md Section 5.","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-17T08:06:09.823743+01:00","updated_at":"2025-12-17T11:33:46.401209+01:00","closed_at":"2025-12-17T11:33:46.401209+01:00","close_reason":"Completed","dependencies":[{"issue_id":"bdel-aw7","depends_on_id":"bdel-5w1","type":"parent-child","created_at":"2025-12-17T08:06:21.650688+01:00","created_by":"daemon"},{"issue_id":"bdel-aw7","depends_on_id":"bdel-dkc","type":"blocks","created_at":"2025-12-17T08:06:31.832389+01:00","created_by":"daemon"}]}
{"id":"bdel-b3t","title":"Project.el integration for per-project beads lists","description":"Add project.el integration so each project can have its own beads list buffer with a unique name.\n\nRequirements:\n1. New `beads-project.el` extension module\n2. Buffer name includes project identifier (root directory name)\n3. Multiple beads list buffers can coexist for different projects\n4. `beads-list` command should be project-aware when called from project context\n5. Optional: project.el integration for `project-switch-project` actions\n\nUse cases:\n- Working on multiple projects simultaneously\n- Switching between projects without losing beads list state\n- Each project's list buffer persists independently\n\nBuffer naming:\n- Current: `*Beads Issues*`\n- With project: `*Beads Issues: project-name*` or `*Beads: ~/code/myproject*`","design":"Implementation plan:\n\n## 1. Create `beads-project.el`\n\n```elisp\n(require 'project)\n\n(defcustom beads-project-buffer-name-function\n  #'beads-project-default-buffer-name\n  \"Function to generate buffer name for project beads list.\nCalled with project root path, returns buffer name string.\"\n  :type 'function\n  :group 'beads)\n\n(defun beads-project-root ()\n  \"Get current project root, or nil if not in a project.\"\n  (when-let ((proj (project-current)))\n    (project-root proj)))\n\n(defun beads-project-name (root)\n  \"Extract project name from ROOT path.\"\n  (file-name-nondirectory (directory-file-name root)))\n\n(defun beads-project-default-buffer-name (root)\n  \"Generate default buffer name for project at ROOT.\"\n  (format \"*Beads: %s*\" (beads-project-name root)))\n\n(defun beads-project-list ()\n  \"Open beads list for current project.\"\n  (interactive)\n  (if-let ((root (beads-project-root)))\n      (let ((default-directory root))\n        (beads-list))\n    (beads-list)))\n```\n\n## 2. Update `beads-list` to use project-aware buffer name\n\n```elisp\n(defun beads-list ()\n  \"Open the Beads issue list buffer.\"\n  (interactive)\n  (let* ((root (and (featurep 'beads-project)\n                    (beads-project-root)))\n         (buffer-name (if root\n                          (funcall beads-project-buffer-name-function root)\n                        \"*Beads Issues*\"))\n         (buffer (get-buffer-create buffer-name)))\n    ...))\n```\n\n## 3. Optional: Add to project.el switch actions\n\n```elisp\n(defun beads-project-switch-action ()\n  \"Switch action to open beads list in project.\"\n  (beads-project-list))\n\n;; Add to project-switch-commands\n(add-to-list 'project-switch-commands\n             '(beads-project-list \"Beads issues\"))\n```\n\n## 4. Store project root in buffer-local variable\n\n```elisp\n(defvar-local beads-list--project-root nil\n  \"Project root for this beads list buffer.\")\n```\n\nThis ensures refresh uses the correct project context.","status":"closed","priority":2,"issue_type":"feature","created_at":"2025-12-17T13:52:42.046797+01:00","updated_at":"2025-12-17T14:06:10.320361+01:00","closed_at":"2025-12-17T14:06:10.320361+01:00","close_reason":"Implemented: beads-project.el with per-project buffer names, project-switch-commands integration, customizable buffer naming, and README.org documentation"}
{"id":"bdel-bum","title":"Implement edit description feature","description":"Add 'e d' keybinding in detail view to edit description:\n- Opens dedicated buffer in markdown-mode\n- Pre-populates with current description (or empty)\n- C-c C-c commits via beads-rpc-update with :description\n- C-c C-k discards\n- Buffer name: *beads-edit: ISSUE-ID description*\n- Refresh detail view after successful commit","status":"closed","priority":1,"issue_type":"task","created_at":"2025-12-17T12:59:14.695125+01:00","updated_at":"2025-12-17T13:08:01.906545+01:00","closed_at":"2025-12-17T13:08:01.906545+01:00","close_reason":"Completed","dependencies":[{"issue_id":"bdel-bum","depends_on_id":"bdel-ab3","type":"parent-child","created_at":"2025-12-17T12:59:36.894485+01:00","created_by":"daemon"},{"issue_id":"bdel-bum","depends_on_id":"bdel-ohr","type":"blocks","created_at":"2025-12-17T12:59:51.028465+01:00","created_by":"daemon"}]}
{"id":"bdel-byj","title":"(Stretch) Form-based metadata editor","description":"Create a custom.el-style form buffer for editing all metadata at once:\n- Display all editable fields in a widget-based form\n- Dropdown/choice widgets for status, priority, type\n- Text fields for title, assignee, external-ref\n- Multi-line text areas for description, design, acceptance, notes\n- Labels as editable list\n- Submit button or C-c C-c to commit all changes\n- Cancel button or C-c C-k to discard\n\nThis is a stretch goal - the individual field editors provide the core functionality.","design":"Use widget.el library (what custom.el uses):\n- widget-create for form fields\n- widget-value to read values\n- widget-setup for buffer initialization\nConsider ewoc.el for list management (labels)","status":"closed","priority":3,"issue_type":"feature","created_at":"2025-12-17T12:59:16.2794+01:00","updated_at":"2025-12-17T13:38:00.359531+01:00","closed_at":"2025-12-17T13:38:00.359531+01:00","close_reason":"Implemented widget-based form editor with all metadata fields, C-c C-c/C-c C-k keybindings, and 'E' shortcut from detail view","dependencies":[{"issue_id":"bdel-byj","depends_on_id":"bdel-ab3","type":"parent-child","created_at":"2025-12-17T12:59:45.420843+01:00","created_by":"daemon"}]}
{"id":"bdel-c0n","title":"Implement filter by status","description":"Add functionality to filter the issue list by status (open, in_progress, blocked, closed). Currently shows \"Filter by status not yet implemented\" message in beads-transient.el.","status":"closed","priority":2,"issue_type":"feature","created_at":"2025-12-17T14:11:19.312379+01:00","updated_at":"2025-12-17T14:41:46.890994+01:00","closed_at":"2025-12-17T14:41:46.890994+01:00","close_reason":"Implemented: completing-read for status, filters list, shows filter name in refresh message"}
{"id":"bdel-cqp","title":"Implement create issue command","description":"Add functionality to create new issues from within beads.el. Currently shows \"Create issue not yet implemented\" message in beads-transient.el.","status":"closed","priority":2,"issue_type":"feature","created_at":"2025-12-17T14:11:19.050639+01:00","updated_at":"2025-12-17T14:37:56.540081+01:00","closed_at":"2025-12-17T14:37:56.540081+01:00","close_reason":"Implemented: prompts for title, type, priority; creates via RPC; refreshes list"}
{"id":"bdel-d29","title":"Implement edit priority with completing-read","description":"Add 'e p' keybinding to change priority:\n- Use completing-read with options: P0 (critical), P1 (high), P2 (normal), P3 (low), P4 (lowest)\n- Show current priority as default\n- Convert selection to integer for RPC\n- Commit via beads-rpc-update with :priority","status":"closed","priority":1,"issue_type":"task","created_at":"2025-12-17T12:59:15.380685+01:00","updated_at":"2025-12-17T13:08:03.04369+01:00","closed_at":"2025-12-17T13:08:03.04369+01:00","close_reason":"Completed","dependencies":[{"issue_id":"bdel-d29","depends_on_id":"bdel-ab3","type":"parent-child","created_at":"2025-12-17T12:59:37.41087+01:00","created_by":"daemon"}]}
{"id":"bdel-dkc","title":"Implement state management","description":"Create beads-state.el with closure-based state manager for view mode, filters, and UI state. Lazy initialization pattern. See docs/emacs-ui.md Section 7.","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-17T08:06:09.744782+01:00","updated_at":"2025-12-17T11:32:32.087389+01:00","closed_at":"2025-12-17T11:32:32.087389+01:00","close_reason":"Completed","dependencies":[{"issue_id":"bdel-dkc","depends_on_id":"bdel-5w1","type":"parent-child","created_at":"2025-12-17T08:06:21.592648+01:00","created_by":"daemon"}]}
{"id":"bdel-dq1","title":"Implement filter by priority","description":"Add functionality to filter the issue list by priority (P0-P4). Currently shows \"Filter by priority not yet implemented\" message in beads-transient.el.","status":"closed","priority":2,"issue_type":"feature","created_at":"2025-12-17T14:11:19.446423+01:00","updated_at":"2025-12-17T14:41:47.017222+01:00","closed_at":"2025-12-17T14:41:47.017222+01:00","close_reason":"Implemented: completing-read for priority P0-P4, filters list, shows filter name in refresh message"}
{"id":"bdel-dyk","title":"Implement undo/redo for editing commands","description":"Add undo/redo capability for issue editing operations using the Command Pattern.\n\n## Research Findings\n\n**Emacs buffer-undo-list is NOT suitable** for this use case:\n- It's designed exclusively for buffer text changes\n- External state (database updates via RPC) cannot use it\n- No major Emacs packages (magit, org-mode, etc.) implement undo for external operations\n\n**Recommended approach: Command Pattern**\n- Store reverse operations as closures in a custom undo stack\n- Each edit captures: issue-id, field, old-value, new-value, timestamp\n- Undo pops from stack, calls RPC with old value, pushes to redo stack\n- Redo pops from redo stack, re-applies, pushes back to undo stack\n\n## Current Edit Flow (insertion points identified)\n\n```\nUser initiates edit\n    ↓\nbeads-edit-field() captures original content in beads-edit--original-content\n    ↓\nUser modifies content\n    ↓\nC-c C-c triggers beads-edit--exit()\n    ↓\n★ UNDO HOOK: Before beads-rpc-update() - have old+new values\n    ↓\nbeads-rpc-update(issue-id, field, new-value)\n    ↓\nbeads-detail-refresh() updates views\n```\n\n## Design Decisions\n\n1. **Scope**: Global undo stack (not per-buffer/per-issue) - simpler, more intuitive\n2. **Persistence**: Session-only (no disk persistence) - avoids complexity and stale state\n3. **Redo**: Yes, full undo/redo support\n4. **Stack size**: Configurable limit (default: 50 operations)\n5. **Form edits**: Single undo entry for all fields changed together\n6. **Conflicts**: Check issue still exists before undo, warn if externally modified\n\n## Keybindings\n\n- `u` - Undo last edit (detail and list modes)\n- `U` or `C-S-/` - Redo","design":"## Architecture\n\n### beads-undo.el module structure\n\n```elisp\n;; Undo entry structure\n(cl-defstruct beads-undo-entry\n  issue-id       ; string\n  field          ; keyword like :title, :description (or :batch for form edits)\n  old-value      ; value before edit\n  new-value      ; value after edit  \n  timestamp      ; when edit occurred\n  description)   ; human-readable description\n\n;; Stacks\n(defvar beads-undo--stack nil \"List of undo entries, most recent first.\")\n(defvar beads-undo--redo-stack nil \"List of redo entries.\")\n(defcustom beads-undo-limit 50 \"Maximum undo history size.\")\n\n;; Core API\n(defun beads-undo-record (issue-id field old-value new-value \u0026optional description)\n  \"Record an edit for undo. Clears redo stack.\")\n\n(defun beads-undo ()\n  \"Undo last edit. Moves entry to redo stack.\"\n  (interactive))\n\n(defun beads-redo ()\n  \"Redo last undone edit. Moves entry back to undo stack.\"\n  (interactive))\n```\n\n### Integration Points\n\n1. **beads-edit.el** - Wrap beads-edit--exit()\n2. **beads-detail.el** - Wrap inline edits (status, priority, type, labels)\n3. **beads-form.el** - Wrap form commit with batch entry\n4. **beads-list.el** - Wrap list-mode inline edits\n\n### Conflict Detection\n\nBefore applying undo:\n1. Fetch current issue via beads-rpc-show\n2. Compare current value with undo-entry's new-value\n3. If different: warn \"Issue was modified externally\"\n4. If issue deleted: error \"Issue no longer exists\"\n\n### Form Edit Batch Undo\n\nFor form edits changing multiple fields:\n- Store as single entry with :batch field type\n- old-value/new-value: alists of (field . val) pairs\n- Undo applies all fields at once","status":"open","priority":3,"issue_type":"epic","created_at":"2025-12-17T13:38:12.284551+01:00","updated_at":"2025-12-17T17:53:24.892646+01:00"}
{"id":"bdel-e7i","title":"Implement RPC layer for daemon communication","description":"Create beads-rpc.el with JSON-over-Unix-socket communication to the beads daemon. See docs/beads-client-howto.md for protocol details and docs/emacs-ui.md Section 1 for architecture.","status":"closed","priority":1,"issue_type":"task","created_at":"2025-12-17T08:06:09.439311+01:00","updated_at":"2025-12-17T08:25:00.286253+01:00","closed_at":"2025-12-17T08:25:00.286253+01:00","close_reason":"Implemented beads-rpc.el with auto-discovery, daemon communication, high-level API functions, and comprehensive tests. Verified working with daemon.","dependencies":[{"issue_id":"bdel-e7i","depends_on_id":"bdel-5w1","type":"parent-child","created_at":"2025-12-17T08:06:21.414017+01:00","created_by":"daemon"},{"issue_id":"bdel-e7i","depends_on_id":"bdel-jlb","type":"blocks","created_at":"2025-12-17T08:11:42.943792+01:00","created_by":"daemon"}]}
{"id":"bdel-eja","title":"Add conflict detection for undo operations","description":"Before applying undo, check for conflicts:\n\n1. Fetch current issue via beads-rpc-show\n2. Compare current field value with undo-entry's new-value\n3. If different: prompt \"Issue was modified externally. Undo anyway? (y/n)\"\n4. If issue deleted (RPC error): show \"Issue no longer exists\"\n5. If user confirms or no conflict: proceed with undo\n\nThis prevents silent data loss when issue was modified by another client or CLI.","status":"open","priority":3,"issue_type":"task","created_at":"2025-12-17T15:01:31.92797+01:00","updated_at":"2025-12-17T15:01:31.92797+01:00","dependencies":[{"issue_id":"bdel-eja","depends_on_id":"bdel-dyk","type":"parent-child","created_at":"2025-12-17T15:01:46.729896+01:00","created_by":"daemon"},{"issue_id":"bdel-eja","depends_on_id":"bdel-0kf","type":"blocks","created_at":"2025-12-17T15:01:59.552336+01:00","created_by":"daemon"}]}
{"id":"bdel-fcc","title":"Set up interactive testing infrastructure","description":"Create infrastructure for interactive Q\u0026A testing of the library.\n\nSet up a way to run Emacs from command line with minimal config that loads beads.el:\n- Use --init-directory to point to a test config directory\n- Create test/interactive/ or similar with init.el that loads the library\n- Add mise task like `mise run interactive` to launch it\n- Document the interactive testing workflow\n\nThis allows manual testing and experimentation without affecting user's Emacs config.","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-17T08:53:52.049042+01:00","updated_at":"2025-12-17T08:57:16.549998+01:00","closed_at":"2025-12-17T08:57:16.549998+01:00","close_reason":"Added dev/init.el and mise run interactive task"}
{"id":"bdel-ijt","title":"Implement detail view mode","description":"Create beads-detail.el for formatted issue display. Show full issue details with faces for visual hierarchy. Accessible via RET from list. See docs/emacs-ui.md Section 4.","status":"closed","priority":1,"issue_type":"task","created_at":"2025-12-17T08:06:09.586503+01:00","updated_at":"2025-12-17T09:06:58.966727+01:00","closed_at":"2025-12-17T09:06:58.966727+01:00","close_reason":"Implemented beads-detail.el with formatted display, faces, side-window, and list integration","dependencies":[{"issue_id":"bdel-ijt","depends_on_id":"bdel-5w1","type":"parent-child","created_at":"2025-12-17T08:06:21.498122+01:00","created_by":"daemon"},{"issue_id":"bdel-ijt","depends_on_id":"bdel-e7i","type":"blocks","created_at":"2025-12-17T08:06:31.756501+01:00","created_by":"daemon"}]}
{"id":"bdel-jlb","title":"Set up Emacs Lisp development tooling (syntax checking, testing, mise tasks)","description":"Set up development infrastructure before implementing RPC layer:\n- Configure mise tasks for build/test/lint\n- Set up elisp syntax checking (check-parens, byte-compilation)\n- Create test framework setup\n- Document in CLAUDE.md","status":"closed","priority":1,"issue_type":"task","created_at":"2025-12-17T08:11:35.432695+01:00","updated_at":"2025-12-17T08:15:57.053017+01:00","closed_at":"2025-12-17T08:15:57.053017+01:00","close_reason":"Tooling setup complete: mise tasks for lint/test/build/check, Python scripts, ERT test framework, CLAUDE.md updated"}
{"id":"bdel-lo4","title":"Implement edit acceptance criteria feature","description":"Add 'e a' keybinding to edit acceptance criteria:\n- Same pattern as description editing\n- Opens markdown-mode buffer\n- C-c C-c commits via :acceptance-criteria field\n- Buffer name: *beads-edit: ISSUE-ID acceptance*","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-17T12:59:14.953621+01:00","updated_at":"2025-12-17T13:08:02.294863+01:00","closed_at":"2025-12-17T13:08:02.294863+01:00","close_reason":"Completed","dependencies":[{"issue_id":"bdel-lo4","depends_on_id":"bdel-ab3","type":"parent-child","created_at":"2025-12-17T12:59:37.06981+01:00","created_by":"daemon"}]}
{"id":"bdel-nde","title":"Create main entry point and autoloads","description":"Create beads.el as main entry point with autoloads, provide beads feature, and M-x beads command to launch the interface.","status":"closed","priority":1,"issue_type":"task","created_at":"2025-12-17T08:06:09.98446+01:00","updated_at":"2025-12-17T09:11:49.517586+01:00","closed_at":"2025-12-17T09:11:49.517586+01:00","close_reason":"Created beads.el with package header, autoloads, and M-x beads command","dependencies":[{"issue_id":"bdel-nde","depends_on_id":"bdel-5w1","type":"parent-child","created_at":"2025-12-17T08:06:21.777537+01:00","created_by":"daemon"},{"issue_id":"bdel-nde","depends_on_id":"bdel-ppm","type":"blocks","created_at":"2025-12-17T08:06:31.913243+01:00","created_by":"daemon"}]}
{"id":"bdel-ohr","title":"Create beads-edit.el infrastructure","description":"Create the base editing infrastructure module with:\n- `beads-edit-mode` minor mode for dedicated edit buffers\n- Buffer-local variables: issue-id, field-name, original-content, allow-write-back\n- `beads-edit-commit` (C-c C-c) - saves changes via RPC, kills buffer\n- `beads-edit-abort` (C-c C-k) - discards changes, kills buffer\n- `beads-edit--create-buffer` helper to set up edit buffer with proper state\n- Hook into appropriate major mode (markdown-mode for text fields)","design":"Follow org-src-mode patterns:\n- Single code path for exit with gate flag\n- Buffer-local state, not global\n- Restore window configuration on exit\n- Optional: overlay on source buffer to show \"editing in progress\"","status":"closed","priority":1,"issue_type":"task","created_at":"2025-12-17T12:59:14.571781+01:00","updated_at":"2025-12-17T13:05:14.031982+01:00","closed_at":"2025-12-17T13:05:14.031982+01:00","close_reason":"Completed","dependencies":[{"issue_id":"bdel-ohr","depends_on_id":"bdel-ab3","type":"parent-child","created_at":"2025-12-17T12:59:36.812795+01:00","created_by":"daemon"}]}
{"id":"bdel-ppm","title":"Implement issue list mode with tabulated-list","description":"Create beads-list.el using tabulated-list-mode. Display columns: ID, status, priority, type, title. See docs/emacs-ui.md Section 2 for column definitions pattern.","status":"closed","priority":1,"issue_type":"task","created_at":"2025-12-17T08:06:09.511876+01:00","updated_at":"2025-12-17T08:53:51.989095+01:00","closed_at":"2025-12-17T08:53:51.989095+01:00","close_reason":"Implemented beads-list.el with tabulated-list-mode, formatters, keybindings, and comprehensive tests. Verified working with daemon.","dependencies":[{"issue_id":"bdel-ppm","depends_on_id":"bdel-5w1","type":"parent-child","created_at":"2025-12-17T08:06:21.454582+01:00","created_by":"daemon"},{"issue_id":"bdel-ppm","depends_on_id":"bdel-e7i","type":"blocks","created_at":"2025-12-17T08:06:31.717382+01:00","created_by":"daemon"}]}
{"id":"bdel-ryp","title":"Implement edit status with completing-read","description":"Add 'e s' keybinding to change status:\n- Use completing-read with options: open, in_progress, blocked, closed\n- Current status as default\n- Commit via beads-rpc-update with :status\n- Refresh view after commit","status":"closed","priority":1,"issue_type":"task","created_at":"2025-12-17T12:59:15.21887+01:00","updated_at":"2025-12-17T13:08:02.846882+01:00","closed_at":"2025-12-17T13:08:02.846882+01:00","close_reason":"Completed","dependencies":[{"issue_id":"bdel-ryp","depends_on_id":"bdel-ab3","type":"parent-child","created_at":"2025-12-17T12:59:37.321263+01:00","created_by":"daemon"}]}
{"id":"bdel-sir","title":"Implement edit title via minibuffer","description":"Add 'e t' keybinding to edit title:\n- Use read-string with current title as default\n- Commit immediately via beads-rpc-update with :title\n- Refresh view after commit\n- Works from both list and detail view","status":"closed","priority":1,"issue_type":"task","created_at":"2025-12-17T12:59:15.084159+01:00","updated_at":"2025-12-17T13:08:02.665283+01:00","closed_at":"2025-12-17T13:08:02.665283+01:00","close_reason":"Completed","dependencies":[{"issue_id":"bdel-sir","depends_on_id":"bdel-ab3","type":"parent-child","created_at":"2025-12-17T12:59:37.187926+01:00","created_by":"daemon"}]}
{"id":"bdel-sk1","title":"Implement labels management","description":"Add label editing commands:\n- 'e l a' - add label (read-string, commit via beads-rpc-label-add)\n- 'e l r' - remove label (completing-read from current labels, beads-rpc-label-remove)\n- Show current labels in prompt","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-17T12:59:15.814362+01:00","updated_at":"2025-12-17T13:16:33.032671+01:00","closed_at":"2025-12-17T13:16:33.032671+01:00","close_reason":"Implemented label management with 'e l a' (add) and 'e l r' (remove) keybindings","dependencies":[{"issue_id":"bdel-sk1","depends_on_id":"bdel-ab3","type":"parent-child","created_at":"2025-12-17T12:59:45.176077+01:00","created_by":"daemon"}]}
{"id":"bdel-uxi","title":"Implement transient menus","description":"Create beads-transient.el with transient.el menus for view switching, filtering, and actions. Dynamic descriptions showing current state. See docs/emacs-ui.md Section 6.","notes":"Keybindings: ? and C-c m should both show the transient menu","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-17T08:06:09.903018+01:00","updated_at":"2025-12-17T09:10:24.173244+01:00","closed_at":"2025-12-17T09:10:24.173244+01:00","close_reason":"Implemented beads-transient.el with main menu, placeholder commands, and keybindings","dependencies":[{"issue_id":"bdel-uxi","depends_on_id":"bdel-5w1","type":"parent-child","created_at":"2025-12-17T08:06:21.713727+01:00","created_by":"daemon"},{"issue_id":"bdel-uxi","depends_on_id":"bdel-aw7","type":"blocks","created_at":"2025-12-17T08:06:31.873138+01:00","created_by":"daemon"}]}
{"id":"bdel-xkf","title":"Implement preview mode (quicklook)","description":"Create beads-preview.el minor mode for automatic preview updates as selection changes. Uses post-command-hook with idle timer debouncing, buffer pooling, deduplication. See docs/emacs-ui.md Section 3.","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-17T08:06:09.663679+01:00","updated_at":"2025-12-17T09:22:23.873517+01:00","closed_at":"2025-12-17T09:22:23.873517+01:00","close_reason":"Implemented beads-preview.el with quicklook functionality","dependencies":[{"issue_id":"bdel-xkf","depends_on_id":"bdel-5w1","type":"parent-child","created_at":"2025-12-17T08:06:21.538561+01:00","created_by":"daemon"},{"issue_id":"bdel-xkf","depends_on_id":"bdel-ijt","type":"blocks","created_at":"2025-12-17T08:06:31.792643+01:00","created_by":"daemon"}]}
{"id":"bdel-xoe","title":"Add undo/redo keybindings and menu entries","description":"Add keybindings and transient menu entries:\n\nKeybindings:\n- `u` in beads-list-mode-map → beads-undo\n- `u` in beads-detail-mode-map → beads-undo\n- `U` in both → beads-redo\n\nTransient menus:\n- Add \"Undo\" section to beads-list-menu and beads-detail-menu\n- Show undo/redo commands\n\nUpdate hints in beads.el to mention `u` for undo.","status":"open","priority":2,"issue_type":"task","created_at":"2025-12-17T15:01:31.743985+01:00","updated_at":"2025-12-17T15:01:31.743985+01:00","dependencies":[{"issue_id":"bdel-xoe","depends_on_id":"bdel-dyk","type":"parent-child","created_at":"2025-12-17T15:01:46.560075+01:00","created_by":"daemon"},{"issue_id":"bdel-xoe","depends_on_id":"bdel-0kf","type":"blocks","created_at":"2025-12-17T15:01:59.412194+01:00","created_by":"daemon"}]}
{"id":"bdel-y1k","title":"Integrate undo with beads-list.el (list view edits)","description":"Add undo recording to list view inline edits:\n\n- beads-list-edit-title\n- beads-list-edit-status\n- beads-list-edit-priority\n- beads-list-edit-type\n- beads-list-edit-description\n\nSame pattern as detail view - record before RPC call.","status":"open","priority":2,"issue_type":"task","created_at":"2025-12-17T15:01:31.55886+01:00","updated_at":"2025-12-17T15:01:31.55886+01:00","dependencies":[{"issue_id":"bdel-y1k","depends_on_id":"bdel-dyk","type":"parent-child","created_at":"2025-12-17T15:01:46.404285+01:00","created_by":"daemon"},{"issue_id":"bdel-y1k","depends_on_id":"bdel-0kf","type":"blocks","created_at":"2025-12-17T15:01:59.258086+01:00","created_by":"daemon"}]}
{"id":"bdel-ydh","title":"Form editor: C-c C-c / C-c C-k don't work inside text fields","description":"The save (C-c C-c) and cancel (C-c C-k) keybindings shown at the top of the form editor only work when point is outside text fields. When editing inside an editable-field or text widget, these bindings don't trigger.\n\nThis is likely because widget keymaps override the mode keymap. Need to extend the widget-specific keymaps (widget-field-keymap, widget-text-keymap) or use a different binding strategy.","design":"**Investigation needed**:\n- Check `widget-field-keymap` and `widget-text-keymap` \n- See how Custom-mode handles this (does it have the same issue?)\n- Options:\n  1. Add bindings to widget keymaps via `:keymap` property on widget creation\n  2. Use `define-key` on the widget-specific keymaps after widget-setup\n  3. Use a minor mode that takes precedence","status":"in_progress","priority":2,"issue_type":"bug","created_at":"2025-12-17T18:33:21.379699+01:00","updated_at":"2025-12-17T18:37:15.458085+01:00"}
